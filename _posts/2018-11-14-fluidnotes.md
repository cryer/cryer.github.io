---
layout: post
title: 流体仿真-基础篇
description: 主要是根据大名鼎鼎的course notes整理的笔记
---

# 前言

  主要是根据Robert Bridson著名的Course Notes，个人写的笔记整理，补充上一些我认为不够清晰的地方。可能分成几个部分，首先先整理基础篇，
  从基本的流体力学方程入手，解释每一项的具体含义，以及原理，然后针对不同的流体特性对方程进行简化，而且NS方程目前还没有人能够求出解析解，
  只有100多个特解，因此只能采用数值上的近似方法，所以接下来会进入数值分析该方程的步骤，近似求解方程，解出速度场，然后进行流体的模拟仿真。
  需要有一定的数学基础：微积分，向量分析，微分方程数值分析等。
  
## 流体力学方程

  
  要进行流体仿真，首先就要搞清楚流体所遵循的物理定律，也就是力学方程，然后才能进行准确的模拟。流体力学中关于流体最重要的方程就是纳维-斯托克斯方程，
  也就是NS方程，具体定义如下：
  
  ![](https://github.com/cryer/cryer.github.io/raw/master/image/fluid_base/1.png)
  
  该方程由两部分组成，一式是动量方程，二式是质量守恒方程，接下来一一解释。在解释之前，先把符号含义定义，u向量指的是流体的速度，p是压强，g向量是重力加速度，
   ρ 是流体的密度，希腊字母ν称为运动粘度。
   
   ```
   由于表达不方便，文中的大部分向量的箭头标志我都省略，比如u，a，g，F等等。
   ```
  
  
### 动量方程

   
   动量方程指的就是一式，乍一看很复杂，其实就是牛顿第二定律，也就是外力的大小等于动量的变化率，或者说F=ma。首先a就是加速度，
   应该等于速度对时间的导数Du/Dt，这里的大D指的是全导数，在流体力学里，这个导数也叫作物质导数或者随体导数。后面会说到
   这个随体导数其实是在拉格朗日方法中用到的，随体就表示跟随物体，先不讨论。
   
   根据牛顿第二定律，ma=F，a用随体导数替换，也就是mDu/Dt=F，m是流体微团的质量，这里用微团表示我们所关注的流体小部分，这是流体力学中经常
   用到的术语。F就是这个微团所受的外力，那么显然，这个外力具体是什么就是接下来的目标。
   
   * 首先比较清晰的是重力，也就是mg，这个微团肯定是会受到重力的
   * 然后是压力，不同的流体微团之间一定会存在压力，压力高的区域挤压压力低的区域，解决压力的问题也是流体仿真中非常非常重要的一部分。那么压力是什么呢？
   压强其实就是压力场的差，压力场的差也就是压力场的梯度，所以我们可以简单的用压力场的梯度的负方向−∇p表示压强，压力就是压强在这个流体微团体积上的积分，
   一般为了简单起见，而且我们假设流体微团足够小，可以直接乘以这个体积近似整个微团的压力，也就是-V*∇p
   * 然后要考虑的就是粘性力，流体之间是有粘性的，区别只是粘性的大小不同，比如蜂蜜的粘性很大，平时的自来水粘性小一些。为了数学建模，粘性从另一方面看
   其实就是为了让当前的流体微团和周围的流体微团的速度相似，即周围流体微团的平均速度。这用拉普拉斯算子来描述在准确不过了，拉普拉斯就是描述了
   与周围平均速度差别的算子，为0时，和周围平均速度一致。拉普拉斯算子记为∇ · ∇，也可以记为∇的平方，其实也就是梯度的散度，展开来说就是空间的二阶导数。
  在向量分析领域，拉普拉斯算子有很重要的意义。和压力一样，为了得到整个微团的粘度，必须对体积积分，也可以简单的乘以体积近似，即V*∇ · ∇u。但是这样衡量不了
  不同粘性流体的区别，因此还需要加上一个动力粘性系数 µ。
  
  把上面的三个外力组合起来可以得到整个流体微团的动量方程：
  
 ![](https://github.com/cryer/cryer.github.io/raw/master/image/fluid_base/2.png)
 
 这个方程要想没有错误，必须取极限，也就是微团数目趋向于无穷多，并且每个流体微团的大小尺寸趋向于0才行，不然这个方程就是错误的。现在有一个问题
 出现了，如果取了极限，那么为微团的重量m和体积V也同样趋向于0了，这就无法计算了，我么可以方程两侧同时除以V，把m和V替换成密度：
 
 ![](https://github.com/cryer/cryer.github.io/raw/master/image/fluid_base/3.png)
 
 现在看起来和一开始给出的NS方程中的动量方程就有点相似了，左右再同时除以密度并且整理一下得到：
 
 ![](https://github.com/cryer/cryer.github.io/raw/master/image/fluid_base/4.png)
 
 为了进一步简化方程，定义ν = µ/ρ，将动力粘性系数除以密度的商定义为动力学粘度ν，得到：
 
 ![](https://github.com/cryer/cryer.github.io/raw/master/image/fluid_base/5.png)
 
 现在看来和NS动量方程更加接近了，唯一的区别就是Du/Dt，也就是我们先前说到的随体导数，下面我们将理解随体导数具体是什么，有什么意义。
 
 
### 拉格朗日描述和欧拉描述

 
 在前面说到随体导数的时候我说道这是在拉格朗日法中用到的，指的就是这里的拉格朗日描述。何为拉格朗日描述？就是把流体看成一个个的粒子组成，
 也可以吧前面的流体微团看成粒子，每个粒子单独拥有自己的属性，包括位置x，速度u等，这个描述和我们对流体的直观理解更加接近，实现起来也较为
 容易，但是缺点是流体粒子之间的交互变得复杂了起来，因为每个粒子都是独立的。而随体导数描述的就是一个量随着时间的变化率，这里不特地指定这个量是
 速度u，更加一般化了，也可以是温度之类的，恰好符合拉格朗日的描述，而拉格朗日法的一大好处就是由于粒子的数目是固定的，因此NS方程中的质量守恒
 方程是自动满足的。
 
 欧拉描述则是一个新的视角，他不把流体看成粒子系统，不会追踪每个粒子，而是只观察空间中的特定的固定点，观察这个点的属性随时间的变化，而这个
 固定点属性的变化是由流体流过而改变的，欧拉描述和人们的直观印象相对不是很符合，但是他也有很多的优点：
 * 更容易处理空间导数，比如压力梯度和粘性的拉普拉斯算子，只需要利用空间点的有限差分即可，而粒子系统比较混乱，难以计算
 * 欧拉网格上近似空间导数比随机移动的粒子方便多了

因此不同于拉格朗日描述遵循的质量守恒，欧拉描述遵循的是体积守恒。

```
其实还有一种LBM法，从微观力学的角度考虑，但是笔记中没有提到，也不再多说
```
 
 而拉格朗日法和欧拉法就是通过随体导数相关联的。为了一般化，我们取一个一般的量q，他关于时间t和位置x，即q(t,x)，不同时间不同位置q值不同。
 现在求q对时间的全导数：
 
 ![](https://github.com/cryer/cryer.github.io/raw/master/image/fluid_base/6.png)
 
 我们可以发现，q对时间点额全导数就是随体导数，这在开始我也提到了，他是在拉格朗日描述中用到的，展开后发现包含了q对时间的偏导，这是与x无关的，
 也就是说x是常数，这个偏导代表了q和常数x位置随时间的变化，正好满足了欧拉描述。而剩下一项是一个修正项，与流过这个固定点的流体有关。组合起来就是
 拉格朗日描述就是欧拉描述加上经过欧拉网格点的流体带来的属性变化。
 
 为了完整，我给出随体导数在三维上的完整形式：
 
  ![](https://github.com/cryer/cryer.github.io/raw/master/image/fluid_base/7.png)
  
  随体导数可以用来表示平流或者说对流，在流体力学中随体导数的那一项也叫作对流项。所谓对流，或者说平流，就是一个量在一个速度场中被速度场输送的过程。
  这一般很好理解，但是当这个量也是速度的时候可能会产生一些混乱，不仅是温度之类的可以再速度场中平流，速度本身也是可以的。
  一般我们取随体导数为0，就是一个简单的平流方程，他表示这个量仅仅在速度场中到处移动，在拉格朗日的视角下，他没有任何变化，即他的温度，速度等没有变化。
  但是在欧拉视角下，可能发生了变化。可以举一个简单的例子：
  ```
  一个一维空间上，不同位置的温度不同，满足T(x)=10x,即x=10处的温度为100.现在这个空间置身于一个流速稳定的速度场中，也就是u=c，是一个常量。
  令DT/Dt=0，解这个平流方程(全导数展开即可)，得到T对t的偏导数为-10c，这意味着对于欧拉描述来说，空间上的某个固定点的温度和速度场的速度大小和
  方向有关。如果c=0，则每一处的温度不变，若风从正方向以c=2吹过，这点的温度将以20的速度上升，下降亦然。
 ```
 
### 不可压缩性

 
 自然界中可压缩流体的仿真很复杂，而且很不常见，所以我们可以只考虑不可压缩流体。而且即使是可压缩的流体，也不太可能发生很大体积的改变，因此我们可以视为
 不可压缩。不可压缩，另一个角度来看就是体积不会改变，密度不会改变，假设一个流体微团，表面为∂Ω，体积为Ω，则我们可以定义这个微团的体积变化率为：
 
 ![](https://github.com/cryer/cryer.github.io/raw/master/image/fluid_base/8.png)
 
体积的变化率等于每小块表面速度法向部分在整个面上的积分，面积分结果大于0，代表总体体积变大，向外的速度大于向内的速度，微团被拉伸。为了得到不可压缩流体，
因此需要满足这个面积分的结果为0.再根据散度定理，把微团面积分转化为整个微团的体积分：
 
 ![](https://github.com/cryer/cryer.github.io/raw/master/image/fluid_base/9.png)
 
 观察到对任意的Ω而言，也就是流体的任意区域，这个方程都应该成立，唯一满足这个条件的函数就只能是0了，因此得到∇ · u = 0，注意到这就是NS方程
 中的二式，我们一开始称为质量守恒方程，其实同时也是不可压缩条件，正因为不可压缩，所以体积不变，然后才能保证质量也不变。满足这个不可压缩条件的向量场
 我们称为“散度自由”或者“零散度”。事实上，仿真不可压缩流体最重要的就是要保证流体时刻处于零散度状态。零散度也是压力产生的原因，因为体积保持不变，
 因此微团一面受力，这面体积缩小，为了满足体积不变，另一面体积就要增大，这就产生了对另一面的压力。
 
 
 
 
 
 
 

  
